<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title></title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <style>
    html,body{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;touch-action:pan-y;}
    #book{position:fixed;top:0;left:0;width:100%;height:100%;perspective:2000px;overflow:hidden;}
    .page{position:absolute;top:0;left:0;width:100%;height:100%;background:#fff;transform-origin:right center;transition:transform 0.6s cubic-bezier(.4,.2,.3,1);box-shadow:0 4px 20px rgba(0,0,0,.3);overflow:hidden;cursor:pointer;}
    .page:hover{transform:rotateY(10deg);}
    .page.flipped{transform:rotateY(180deg);z-index:0;}
    canvas{width:100%;height:100%;object-fit:cover;}
  </style>
</head>
<body>
  <div id="book"></div>

  <script>
    const pdfUrl = 'https://minskw.github.io/flipbook/taskhir.pdf';
    const book = document.getElementById('book');
    let pdfDoc=null,currentPage=1,totalPages=0,pages=[];
    let touchStartX=0,touchEndX=0;

    pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    async function loadPDF(){
      const loading=await pdfjsLib.getDocument(pdfUrl).promise;
      pdfDoc=loading;totalPages=pdfDoc.numPages;
      const scale = calculateScale();
      for(let i=1;i<=totalPages;i++){
        const page=await pdfDoc.getPage(i);
        const viewport=page.getViewport({scale});
        const canvas=document.createElement('canvas');
        const ctx=canvas.getContext('2d');
        canvas.width=viewport.width;canvas.height=viewport.height;
        await page.render({canvasContext:ctx,viewport}).promise;
        const pageDiv=document.createElement('div');
        pageDiv.className='page';
        pageDiv.style.zIndex=totalPages-i;
        pageDiv.appendChild(canvas);
        pageDiv.addEventListener('click',()=>{
          pageDiv.classList.toggle('flipped');
        });
        book.appendChild(pageDiv);
        pages.push(pageDiv);
      }
    }

    function calculateScale(){
      const baseWidth = 800; // approximate PDF width
      const screenWidth = window.innerWidth;
      return screenWidth / baseWidth;
    }

    function nextPage(){
      if(currentPage<=totalPages){
        pages[currentPage-1].classList.add('flipped');
        currentPage++;
      }
    }

    function prevPage(){
      if(currentPage>1){
        currentPage--;
        pages[currentPage-1].classList.remove('flipped');
      }
    }

    // Swipe detection for mobile
    book.addEventListener('touchstart',e=>{
      touchStartX = e.changedTouches[0].screenX;
    });

    book.addEventListener('touchend',e=>{
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    function handleSwipe(){
      const diff = touchEndX - touchStartX;
      if(Math.abs(diff) < 50) return;
      if(diff > 0) nextPage(); // swipe kanan untuk halaman berikutnya
      else prevPage(); // swipe kiri untuk halaman sebelumnya
    }

    window.addEventListener('resize',()=>{
      location.reload(); // reload agar PDF menyesuaikan layar saat orientasi berubah
    });

    loadPDF();
  </script>
</body>
</html>
